# ğŸ¤API Contracts & Testing at Porter

### ğŸ¯Â [Test Strategy 2.0 Summary Doc:](../../Porter%20Testing%20Strategy%202%200%20Summary%202269c6eaaa6d803f993fec053681ba02.md)

### **Contract Testing current gaps:**

1. Lack of single source of truth for API contracts
2. For testing needs: 
    1. Contracts are extracted using external tools such as Chucker, DataDog, or manually from devâ€™s help
    2. Contracts are part of PRDs but not openly shared or readily accessible
    3. BE applications shareâ€™s itâ€™s API client and API models with version tags in Google Artifactory Registry
3. API contracts(json) are not clear which what fields are required or optional
4. API contracts are not stored in a central location, We are not following API First or Schema First approach during Service Development
5. No clarity on Backward and Forward compatibility of the schemas/contracts
6. No current pipeline as in case of `event-entities` to:
    1. prevent contract drift
    2. ensuring breaking changes are not allowed
    3. for schema structure sanctity

### Attempts at solving gaps in contract Testing:

1. API First or Schama First approach
2. Consumer Driver contracts

## ğŸ§ª Head-to-Head Comparison: CDC vs OpenAPI Schema-First

| Criteria | CDC (Pact / Spring Cloud Contract) | OpenAPI Schema-First | Porter Context |
| --- | --- | --- | --- |
| ğŸ”§ Tooling Maturity | Decent (mostly REST focus, immature for Kafka) | âœ… Mature, wide ecosystem |  |
| ğŸ§ª Testing Rigor | âœ… Strong for consumer-driven flow | âš ï¸ Schema diff + test tool required |  |
| ğŸ“¦ Ease of Adoption | âŒ High â€” requires Pact Broker, custom flows  | âœ… Easy â€” YAML + generators |  |
| ğŸ”„ Feedback Loop | âœ… Real-time in CI via mocks & tests | âš ï¸ Needs setup (diffing, test gen) |  |
| ğŸ§© Use Case Fit | REST + some async (Kafka/PubSub via plugin) | âœ… REST APIs, API-first teams |  |
| ğŸ” Observability | âŒ Limited | âš ï¸ Optional (Optic, custom middleware) |  |
| ğŸ” Contract Versioning | âœ… Built-in via Pact Broker | âš ï¸ Manual or via registry |  |
| ğŸš€ Developer Experience | âŒ Requires consumers to write tests | âœ… Autogenerated docs, stubs |  |
| ğŸ” Consumer Safety | âœ… Very strong â€” consumers define expectations | âš ï¸ Depends on schema discipline |  |

## ğŸ§ª Recommended POC Setup:

| Service | Strategy | Notes |
| --- | --- | --- |
| ğŸ”µ Customer API, Pricing API | **OpenAPI Schema-First** | Good fit for public/REST services |
| ğŸ”´ Pub/Sub, Kafka services | **AsyncAPI + Avro/Protobuf + CI schema checks** | Prevent contract drift
Already being followed for kafka in `event-entities` repo |
| ğŸŸ¡ Fury, Order, Allocation | Run **optional CDC POC** if tight coupling & shared ownership exists | Validate CI overhead vs benefits |

## âœ… Do We Have Great Tooling for OpenAPI Spec?

**Yes â€” OpenAPI is extremely well-supported**, especially for REST APIs. The ecosystem is mature, scalable, and enterprise-ready.

### ğŸ› ï¸ Popular OpenAPI Tools by Use Case:

| Use Case | Tool | Notes |
| --- | --- | --- |
| ğŸ“ Authoring | Swagger Editor, Stoplight Studio | Intuitive GUI + linting |
| ğŸ” Linting / Validation | [Spectral](https://github.com/stoplightio/spectral), [openapi-cli](https://github.com/Redocly/openapi-cli) | Checks structure, naming, conventions |
| ğŸ” Diffing | [openapi-diff](https://github.com/OpenAPITools/openapi-diff), Optic | Checks compatibility between versions |
| ğŸ§ª Testing | [Dredd](https://github.com/apiaryio/dredd), Schemathesis | Run real tests from OpenAPI specs |
| ğŸ“š Docs | Swagger UI, [Redoc](https://github.com/Redocly/redoc) | Public or internal API documentation |
| ğŸ§¬ Client/Server Stubs | OpenAPI Generator, Swagger Codegen | Generate SDKs and mocks |
| ğŸ¢ Registry | SwaggerHub, Backstage | Internal contract catalog |
| âœ… CI Tools | GitHub Actions, GitLab, Jenkins + CLI tools | Easy integration |

## ğŸ Which One is Better?

| Goal | Best Choice | Why |
| --- | --- | --- |
| ğŸš€ Fastest adoption, easy onboarding | **OpenAPI** | No infra, existing tools, great dev experience |
| ğŸ”¬ Strongest consumer contract protection | **CDC** | Consumers own contract, tight validation |
| ğŸ§  Suitable for large teams, public APIs | **OpenAPI** | Shared schema, central registry |
| ğŸ“‰ Low coupling & clean versioning | **OpenAPI** | Fewer dependencies between services |
| ğŸ”„ Ideal for event-driven systems | **Neither alone** â€” use **AsyncAPI + schema validation** |  |

## ğŸ“Œ Final Suggestions:

| Item | Recommendation |
| --- | --- |
| âœ… Primary path | OpenAPI + CI diffing + Spectral + Backstage or SwaggerHub |
| âœ… For events | AsyncAPI + schema registry + version diff in CI |
| âŒ For now | Skip CDC unless we identify high-risk tight integrations |
| ğŸ” POC Outcome | Measure: developer effort, CI pipeline stability, velocity |